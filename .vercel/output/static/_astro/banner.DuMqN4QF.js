import{j as a}from"./jsx-runtime.CDeAccHH.js";import{r as d}from"./index.oIQ917gr.js";import{a as z,b as w,M as U,i as R,u as V,c as G,f as y,d as j,p as X,v as F,e as Y,g as J,w as q,m as A}from"./motion.DmQNgYpf.js";import"./index.D2MAbzvX.js";function _(e){const t=z(()=>w(e)),{isStatic:o}=d.useContext(U);if(o){const[,s]=d.useState(e);d.useEffect(()=>t.on("change",s),[])}return t}const $=e=>e&&typeof e=="object"&&e.mix,K=e=>$(e)?e.mix:void 0;function Q(...e){const t=!Array.isArray(e[0]),o=t?0:-1,s=e[0+o],n=e[1+o],r=e[2+o],i=e[3+o],c=R(n,r,{mixer:K(r[0]),...i});return t?c(s):c}function I(e,t){const o=_(t()),s=()=>o.set(t());return s(),V(()=>{const n=()=>y.update(s,!1,!0),r=e.map(i=>i.on("change",n));return()=>{r.forEach(i=>i()),G(s)}}),o}function Z(e){j.current=[],e();const t=I(j.current,e);return j.current=void 0,t}function ee(e,t,o,s){if(typeof e=="function")return Z(e);const n=typeof t=="function"?t:Q(t,o,s);return Array.isArray(e)?O(e,n):O([e],([r])=>n(r))}function O(e,t){const o=z(()=>[]);return I(e,()=>{o.length=0;const s=e.length;for(let n=0;n<s;n++)o[n]=e[n].get();return t(o)})}function te(e,t,o){return typeof e=="string"?e=document.querySelectorAll(e):e instanceof Element&&(e=[e]),Array.from(e||[])}const E=new WeakMap;let g;function se(e,t){if(t){const{inlineSize:o,blockSize:s}=t[0];return{width:o,height:s}}else return e instanceof SVGElement&&"getBBox"in e?e.getBBox():{width:e.offsetWidth,height:e.offsetHeight}}function ne({target:e,contentRect:t,borderBoxSize:o}){var s;(s=E.get(e))===null||s===void 0||s.forEach(n=>{n({target:e,contentSize:t,get size(){return se(e,o)}})})}function oe(e){e.forEach(ne)}function re(){typeof ResizeObserver>"u"||(g=new ResizeObserver(oe))}function ie(e,t){g||re();const o=te(e);return o.forEach(s=>{let n=E.get(s);n||(n=new Set,E.set(s,n)),n.add(t),g?.observe(s)}),()=>{o.forEach(s=>{const n=E.get(s);n?.delete(t),n?.size||g?.unobserve(s)})}}const S=new Set;let v;function le(){v=()=>{const e={width:window.innerWidth,height:window.innerHeight},t={target:window,size:e,contentSize:e};S.forEach(o=>o(t))},window.addEventListener("resize",v)}function ae(e){return S.add(e),v||le(),()=>{S.delete(e),!S.size&&v&&(v=void 0)}}function ce(e,t){return typeof e=="function"?ae(e):ie(e,t)}const ue=50,C=()=>({current:0,offset:[],progress:0,scrollLength:0,targetOffset:0,targetLength:0,containerLength:0,velocity:0}),de=()=>({time:0,x:C(),y:C()}),fe={x:{length:"Width",position:"Left"},y:{length:"Height",position:"Top"}};function H(e,t,o,s){const n=o[t],{length:r,position:i}=fe[t],c=n.current,f=o.time;n.current=e["scroll"+i],n.scrollLength=e["scroll"+r]-e["client"+r],n.offset.length=0,n.offset[0]=0,n.offset[1]=n.scrollLength,n.progress=X(0,n.scrollLength,n.current);const l=s-f;n.velocity=l>ue?0:F(n.current-c,l)}function he(e,t,o){H(e,"x",t,o),H(e,"y",t,o),t.time=o}function me(e,t){const o={x:0,y:0};let s=e;for(;s&&s!==t;)if(s instanceof HTMLElement)o.x+=s.offsetLeft,o.y+=s.offsetTop,s=s.offsetParent;else if(s.tagName==="svg"){const n=s.getBoundingClientRect();s=s.parentElement;const r=s.getBoundingClientRect();o.x+=n.left-r.left,o.y+=n.top-r.top}else if(s instanceof SVGGraphicsElement){const{x:n,y:r}=s.getBBox();o.x+=n,o.y+=r;let i=null,c=s.parentNode;for(;!i;)c.tagName==="svg"&&(i=c),c=s.parentNode;s=i}else break;return o}const pe={Enter:[[0,1],[1,1]],Exit:[[0,0],[1,0]],Any:[[1,0],[0,1]],All:[[0,0],[1,1]]},L={start:0,center:.5,end:1};function W(e,t,o=0){let s=0;if(L[e]!==void 0&&(e=L[e]),typeof e=="string"){const n=parseFloat(e);e.endsWith("px")?s=n:e.endsWith("%")?e=n/100:e.endsWith("vw")?s=n/100*document.documentElement.clientWidth:e.endsWith("vh")?s=n/100*document.documentElement.clientHeight:e=n}return typeof e=="number"&&(s=t*e),o+s}const ge=[0,0];function xe(e,t,o,s){let n=Array.isArray(e)?e:ge,r=0,i=0;return typeof e=="number"?n=[e,e]:typeof e=="string"&&(e=e.trim(),e.includes(" ")?n=e.split(" "):n=[e,L[e]?e:"0"]),r=W(n[0],o,s),i=W(n[1],t),r-i}const we={x:0,y:0};function ye(e){return"getBBox"in e&&e.tagName!=="svg"?e.getBBox():{width:e.clientWidth,height:e.clientHeight}}function ve(e,t,o){const{offset:s=pe.All}=o,{target:n=e,axis:r="y"}=o,i=r==="y"?"height":"width",c=n!==e?me(n,e):we,f=n===e?{width:e.scrollWidth,height:e.scrollHeight}:ye(n),l={width:e.clientWidth,height:e.clientHeight};t[r].offset.length=0;let m=!t[r].interpolate;const h=s.length;for(let u=0;u<h;u++){const p=xe(s[u],l[i],f[i],c[r]);!m&&p!==t[r].interpolatorOffsets[u]&&(m=!0),t[r].offset[u]=p}m&&(t[r].interpolate=R(t[r].offset,Y(s)),t[r].interpolatorOffsets=[...t[r].offset]),t[r].progress=t[r].interpolate(t[r].current)}function be(e,t=e,o){if(o.x.targetOffset=0,o.y.targetOffset=0,t!==e){let s=t;for(;s&&s!==e;)o.x.targetOffset+=s.offsetLeft,o.y.targetOffset+=s.offsetTop,s=s.offsetParent}o.x.targetLength=t===e?t.scrollWidth:t.clientWidth,o.y.targetLength=t===e?t.scrollHeight:t.clientHeight,o.x.containerLength=e.clientWidth,o.y.containerLength=e.clientHeight}function Ee(e,t,o,s={}){return{measure:()=>be(e,s.target,o),update:n=>{he(e,o,n),(s.offset||s.target)&&ve(e,o,s)},notify:()=>t(o)}}const x=new WeakMap,T=new WeakMap,k=new WeakMap,B=e=>e===document.documentElement?window:e;function Se(e,{container:t=document.documentElement,...o}={}){let s=k.get(t);s||(s=new Set,k.set(t,s));const n=de(),r=Ee(t,e,n,o);if(s.add(r),!x.has(t)){const c=()=>{for(const u of s)u.measure()},f=()=>{for(const u of s)u.update(J.timestamp)},l=()=>{for(const u of s)u.notify()},m=()=>{y.read(c,!1,!0),y.read(f,!1,!0),y.update(l,!1,!0)};x.set(t,m);const h=B(t);window.addEventListener("resize",m,{passive:!0}),t!==document.documentElement&&T.set(t,ce(t,m)),h.addEventListener("scroll",m,{passive:!0})}const i=x.get(t);return y.read(i,!1,!0),()=>{var c;G(i);const f=k.get(t);if(!f||(f.delete(r),f.size))return;const l=x.get(t);x.delete(t),l&&(B(t).removeEventListener("scroll",l),(c=T.get(t))===null||c===void 0||c(),window.removeEventListener("resize",l))}}function M(e,t){q(!!(!t||t.current))}const je=()=>({scrollX:w(0),scrollY:w(0),scrollXProgress:w(0),scrollYProgress:w(0)});function ke({container:e,target:t,layoutEffect:o=!0,...s}={}){const n=z(je);return(o?V:d.useEffect)(()=>(M("target",t),M("container",e),Se(({x:i,y:c})=>{n.scrollX.set(i.current),n.scrollXProgress.set(i.progress),n.scrollY.set(c.current),n.scrollYProgress.set(c.progress)},{...s,container:e?.current||void 0,target:t?.current||void 0})),[e,t,JSON.stringify(s.offset)]),n}const Le=()=>{const[e,t]=d.useState(""),[o,s]=d.useState(""),[n,r]=d.useState(null),[i,c]=d.useState(!1),[f,l]=d.useState(""),m=async h=>{h.preventDefault(),c(!0),l("");try{let u=null;if(n){const b=new FileReader;b.readAsDataURL(n);const N=await new Promise(P=>{b.onload=()=>P(b.result),b.onerror=()=>P(null)});if(!N)throw new Error("Gagal memproses gambar.");u={name:n.name,type:n.type,data:N.split(",")[1]}}const p=await fetch("/api/promotions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:e,description:o,image:u})}),D=await p.json();if(!p.ok)throw new Error(D.error||"Gagal menambahkan promosi.");l("Promosi berhasil ditambahkan!"),t(""),s(""),r(null)}catch(u){l(u.message||"Terjadi kesalahan")}finally{c(!1)}};return a.jsxs("div",{className:"w-full max-w-[500px] bg-white mx-auto mt-10 p-5 border rounded shadow-xl",children:[a.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Tambah Promo"}),a.jsxs("form",{onSubmit:m,className:"flex flex-col gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block font-semibold mb-1",children:"Judul Promosi"}),a.jsx("input",{type:"text",value:e,onChange:h=>t(h.target.value),required:!0,className:"w-full border px-3 py-2 rounded"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block font-semibold mb-1",children:"Deskripsi (Opsional)"}),a.jsx("textarea",{value:o,onChange:h=>s(h.target.value),className:"w-full border px-3 py-2 rounded"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block font-semibold mb-1",children:"Gambar (Opsional)"}),a.jsx("input",{type:"file",accept:"image/*",onChange:h=>r(h.target.files?.[0]||null),className:"w-full"})]}),a.jsx("button",{type:"submit",disabled:i,className:"bg-blue-500 text-white px-4 py-2 rounded",children:i?"Menambahkan...":"Tambah Promosi"})]}),f&&a.jsx("p",{className:"mt-4 text-green-500",children:f})]})},ze=()=>{const[e,t]=d.useState([]),[o,s]=d.useState(null),[n,r]=d.useState(!0),[i,c]=d.useState(null);d.useEffect(()=>{let l=!0;const m=async()=>{try{r(!0);const u=await fetch("/api/promotions");if(!u.ok)throw new Error("Gagal memuat promosi");const p=await u.json();l&&t(p)}catch{l&&c("Gagal memuat promosi.")}finally{l&&r(!1)}};return(async()=>{try{const u=await fetch("/api/checksession");if(!u.ok)throw new Error("Session invalid");const p=await u.json();s(p.user)}catch(u){console.error("Failed to fetch user:",u),s(null)}})(),m(),()=>{l=!1}},[]);const f=async(l,m)=>{try{if(!window.confirm("Apakah Anda yakin ingin menghapus promo ini?"))return;if(!(await fetch("/api/promotions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({promotionId:l,imageUrl:m})})).ok)throw new Error("Gagal menghapus promosi.");t(u=>u.filter(p=>p.id!==l))}catch(h){alert(h.message||"Terjadi kesalahan saat menghapus promosi.")}};return n?a.jsx("p",{children:"Loading..."}):i?a.jsx("p",{children:i}):a.jsx("div",{className:"overflow-hidden",children:a.jsx("div",{className:"flex relative w-full overflow-hidden my-12",children:a.jsx("div",{className:"w-full flex gap-20 md:gap-32 lg:gap-40 animate-loop-scroll",children:e.map(l=>a.jsxs("div",{className:"p-2 text-slate-950 flex flex-col items-stretch relative",children:[!l.imageUrl&&a.jsx("p",{className:"w-80 text-lg md:text-xl lg:text-2xl font-serif tracking-widest font-semibold text-primary",children:l.title}),l.imageUrl&&a.jsx("img",{loading:"lazy",className:"max-w-80 h-20 md:h-28 object-cover rounded-xl",src:l.imageUrl,alt:l.title}),o&&a.jsx("button",{onClick:()=>f(l.id,l.imageUrl),className:"w-auto py-0 px-2 text-black absolute -top-0 -right-2 backdrop-blur-md rounded shadow z-50",children:"X"})]},l.id))})})})},Ce=()=>{const[e,t]=d.useState(null),[o,s]=d.useState(!1),{scrollYProgress:n}=ke(),r=ee(n,[0,1],[0,-500]);return d.useEffect(()=>{(async()=>{try{const c=await fetch("/api/checksession");if(!c.ok)throw new Error("Session invalid");const f=await c.json();t(f.user)}catch(c){console.error("Failed to fetch user:",c),t(null)}})()},[]),a.jsxs("section",{className:"overflow-hidden mt-52 md:mt-32 lg:mt-0",children:[a.jsxs("div",{className:"flex gap-4",children:[a.jsx(A.h1,{style:{x:r},className:"flex items-center text-[2em] font-mono font-semibold z-10 m-0 whitespace-nowrap mt-auto ml-8 transition-all duration-[2s] ease-[cubic-bezier(0.165,0.84,0.44,1)]",children:"Promo"}),e?a.jsx(A.button,{style:{x:r},onClick:()=>{s(!0)},className:"border border-dark px-4 rounded-lg z-10",children:"Tambahkan Promo"}):""]}),a.jsx(ze,{}),o?a.jsx("div",{onClick:()=>{s(!1)},className:"w-full h-[100vh] bg-dark/50 flex justify-center items-center fixed left-0 top-0 z-[99]",children:a.jsx("div",{onClick:i=>i.stopPropagation(),children:a.jsx(Le,{})})}):""]})};export{Ce as default};
