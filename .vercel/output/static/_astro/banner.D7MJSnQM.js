import{j as a}from"./jsx-runtime.CDeAccHH.js";import{r as m}from"./index.AGWyUyCC.js";import{s as x}from"./supabaseClient.CAFQAGi9.js";import{a as $}from"./apiServices.DXWvDrVz.js";import{a as P,b as v,M as _,i as U,u as I,c as V,f as b,d as L,p as X,v as Y,e as q,g as F,w as J,m as A}from"./motion.DW-nebHY.js";import"./index.D2MAbzvX.js";function K(e){const t=P(()=>v(e)),{isStatic:r}=m.useContext(_);if(r){const[,s]=m.useState(e);m.useEffect(()=>t.on("change",s),[])}return t}const Q=e=>e&&typeof e=="object"&&e.mix,Z=e=>Q(e)?e.mix:void 0;function ee(...e){const t=!Array.isArray(e[0]),r=t?0:-1,s=e[0+r],n=e[1+r],o=e[2+r],l=e[3+r],c=U(n,o,{mixer:Z(o[0]),...l});return t?c(s):c}function D(e,t){const r=K(t()),s=()=>r.set(t());return s(),I(()=>{const n=()=>b.update(s,!1,!0),o=e.map(l=>l.on("change",n));return()=>{o.forEach(l=>l()),V(s)}}),r}function te(e){L.current=[],e();const t=D(L.current,e);return L.current=void 0,t}function se(e,t,r,s){if(typeof e=="function")return te(e);const n=typeof t=="function"?t:ee(t,r,s);return Array.isArray(e)?C(e,n):C([e],([o])=>n(o))}function C(e,t){const r=P(()=>[]);return D(e,()=>{r.length=0;const s=e.length;for(let n=0;n<s;n++)r[n]=e[n].get();return t(r)})}function ne(e,t,r){return typeof e=="string"?e=document.querySelectorAll(e):e instanceof Element&&(e=[e]),Array.from(e||[])}const S=new WeakMap;let p;function re(e,t){if(t){const{inlineSize:r,blockSize:s}=t[0];return{width:r,height:s}}else return e instanceof SVGElement&&"getBBox"in e?e.getBBox():{width:e.offsetWidth,height:e.offsetHeight}}function oe({target:e,contentRect:t,borderBoxSize:r}){var s;(s=S.get(e))===null||s===void 0||s.forEach(n=>{n({target:e,contentSize:t,get size(){return re(e,r)}})})}function le(e){e.forEach(oe)}function ie(){typeof ResizeObserver>"u"||(p=new ResizeObserver(le))}function ae(e,t){p||ie();const r=ne(e);return r.forEach(s=>{let n=S.get(s);n||(n=new Set,S.set(s,n)),n.add(t),p?.observe(s)}),()=>{r.forEach(s=>{const n=S.get(s);n?.delete(t),n?.size||p?.unobserve(s)})}}const j=new Set;let y;function ce(){y=()=>{const e={width:window.innerWidth,height:window.innerHeight},t={target:window,size:e,contentSize:e};j.forEach(r=>r(t))},window.addEventListener("resize",y)}function ue(e){return j.add(e),y||ce(),()=>{j.delete(e),!j.size&&y&&(y=void 0)}}function de(e,t){return typeof e=="function"?ue(e):ae(e,t)}const fe=50,H=()=>({current:0,offset:[],progress:0,scrollLength:0,targetOffset:0,targetLength:0,containerLength:0,velocity:0}),me=()=>({time:0,x:H(),y:H()}),he={x:{length:"Width",position:"Left"},y:{length:"Height",position:"Top"}};function W(e,t,r,s){const n=r[t],{length:o,position:l}=he[t],c=n.current,f=r.time;n.current=e["scroll"+l],n.scrollLength=e["scroll"+o]-e["client"+o],n.offset.length=0,n.offset[0]=0,n.offset[1]=n.scrollLength,n.progress=X(0,n.scrollLength,n.current);const i=s-f;n.velocity=i>fe?0:Y(n.current-c,i)}function ge(e,t,r){W(e,"x",t,r),W(e,"y",t,r),t.time=r}function pe(e,t){const r={x:0,y:0};let s=e;for(;s&&s!==t;)if(s instanceof HTMLElement)r.x+=s.offsetLeft,r.y+=s.offsetTop,s=s.offsetParent;else if(s.tagName==="svg"){const n=s.getBoundingClientRect();s=s.parentElement;const o=s.getBoundingClientRect();r.x+=n.left-o.left,r.y+=n.top-o.top}else if(s instanceof SVGGraphicsElement){const{x:n,y:o}=s.getBBox();r.x+=n,r.y+=o;let l=null,c=s.parentNode;for(;!l;)c.tagName==="svg"&&(l=c),c=s.parentNode;s=l}else break;return r}const xe={Enter:[[0,1],[1,1]],Exit:[[0,0],[1,0]],Any:[[1,0],[0,1]],All:[[0,0],[1,1]]},N={start:0,center:.5,end:1};function O(e,t,r=0){let s=0;if(N[e]!==void 0&&(e=N[e]),typeof e=="string"){const n=parseFloat(e);e.endsWith("px")?s=n:e.endsWith("%")?e=n/100:e.endsWith("vw")?s=n/100*document.documentElement.clientWidth:e.endsWith("vh")?s=n/100*document.documentElement.clientHeight:e=n}return typeof e=="number"&&(s=t*e),r+s}const we=[0,0];function ve(e,t,r,s){let n=Array.isArray(e)?e:we,o=0,l=0;return typeof e=="number"?n=[e,e]:typeof e=="string"&&(e=e.trim(),e.includes(" ")?n=e.split(" "):n=[e,N[e]?e:"0"]),o=O(n[0],r,s),l=O(n[1],t),o-l}const be={x:0,y:0};function ye(e){return"getBBox"in e&&e.tagName!=="svg"?e.getBBox():{width:e.clientWidth,height:e.clientHeight}}function Ee(e,t,r){const{offset:s=xe.All}=r,{target:n=e,axis:o="y"}=r,l=o==="y"?"height":"width",c=n!==e?pe(n,e):be,f=n===e?{width:e.scrollWidth,height:e.scrollHeight}:ye(n),i={width:e.clientWidth,height:e.clientHeight};t[o].offset.length=0;let h=!t[o].interpolate;const d=s.length;for(let u=0;u<d;u++){const g=ve(s[u],i[l],f[l],c[o]);!h&&g!==t[o].interpolatorOffsets[u]&&(h=!0),t[o].offset[u]=g}h&&(t[o].interpolate=U(t[o].offset,q(s)),t[o].interpolatorOffsets=[...t[o].offset]),t[o].progress=t[o].interpolate(t[o].current)}function Se(e,t=e,r){if(r.x.targetOffset=0,r.y.targetOffset=0,t!==e){let s=t;for(;s&&s!==e;)r.x.targetOffset+=s.offsetLeft,r.y.targetOffset+=s.offsetTop,s=s.offsetParent}r.x.targetLength=t===e?t.scrollWidth:t.clientWidth,r.y.targetLength=t===e?t.scrollHeight:t.clientHeight,r.x.containerLength=e.clientWidth,r.y.containerLength=e.clientHeight}function je(e,t,r,s={}){return{measure:()=>Se(e,s.target,r),update:n=>{ge(e,r,n),(s.offset||s.target)&&Ee(e,r,s)},notify:()=>t(r)}}const w=new WeakMap,B=new WeakMap,z=new WeakMap,M=e=>e===document.documentElement?window:e;function Le(e,{container:t=document.documentElement,...r}={}){let s=z.get(t);s||(s=new Set,z.set(t,s));const n=me(),o=je(t,e,n,r);if(s.add(o),!w.has(t)){const c=()=>{for(const u of s)u.measure()},f=()=>{for(const u of s)u.update(F.timestamp)},i=()=>{for(const u of s)u.notify()},h=()=>{b.read(c,!1,!0),b.read(f,!1,!0),b.update(i,!1,!0)};w.set(t,h);const d=M(t);window.addEventListener("resize",h,{passive:!0}),t!==document.documentElement&&B.set(t,de(t,h)),d.addEventListener("scroll",h,{passive:!0})}const l=w.get(t);return b.read(l,!1,!0),()=>{var c;V(l);const f=z.get(t);if(!f||(f.delete(o),f.size))return;const i=w.get(t);w.delete(t),i&&(M(t).removeEventListener("scroll",i),(c=B.get(t))===null||c===void 0||c(),window.removeEventListener("resize",i))}}function T(e,t){J(!!(!t||t.current))}const ze=()=>({scrollX:v(0),scrollY:v(0),scrollXProgress:v(0),scrollYProgress:v(0)});function Ne({container:e,target:t,layoutEffect:r=!0,...s}={}){const n=P(ze);return(r?I:m.useEffect)(()=>(T("target",t),T("container",e),Le(({x:l,y:c})=>{n.scrollX.set(l.current),n.scrollXProgress.set(l.progress),n.scrollY.set(c.current),n.scrollYProgress.set(c.progress)},{...s,container:e?.current||void 0,target:t?.current||void 0})),[e,t,JSON.stringify(s.offset)]),n}var Pe={};const ke=()=>{const[e,t]=m.useState(""),[r,s]=m.useState(""),[n,o]=m.useState(null),[l,c]=m.useState(!1),[f,i]=m.useState(""),h=async d=>{d.preventDefault(),c(!0),i("");try{let u=null;if(n){const G=`${Date.now()}-${n.name}`,{data:R,error:k}=await x.storage.from("promotion images").upload(G,n);if(k)throw new Error(`Gagal mengunggah gambar: ${k.message}`);u=`${Pe.PUBLIC_SUPABASE_URL}/storage/v1/object/public/promotion images/${R?.path}`}const{data:g,error:E}=await x.from("Promotion").insert([{title:e,description:r,imageUrl:u}]).select();if(E)throw new Error(`Gagal menyimpan data promosi: ${E.message}`);i("Promosi berhasil ditambahkan!"),t(""),s(""),o(null)}catch(u){i(u.message||"Terjadi kesalahan")}finally{c(!1)}};return a.jsxs("div",{className:"w-full max-w-[500px] bg-white mx-auto mt-10 p-5 border rounded shadow-xl",children:[a.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Tambah Promo"}),a.jsxs("form",{onSubmit:h,className:"flex flex-col gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block font-semibold mb-1",children:"Judul Promosi"}),a.jsx("input",{type:"text",value:e,onChange:d=>t(d.target.value),required:!0,className:"w-full border px-3 py-2 rounded"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block font-semibold mb-1",children:"Deskripsi (Opsional)"}),a.jsx("textarea",{value:r,onChange:d=>s(d.target.value),className:"w-full border px-3 py-2 rounded"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block font-semibold mb-1",children:"Gambar (Opsional)"}),a.jsx("input",{type:"file",accept:"image/*",onChange:d=>o(d.target.files?.[0]||null),className:"w-full"})]}),a.jsx("button",{type:"submit",disabled:l,className:"bg-blue-500 text-white px-4 py-2 rounded",children:l?"Menambahkan...":"Tambah Promosi"})]}),f&&a.jsx("p",{className:"mt-4 text-green-500",children:f})]})},Ae=()=>{const[e,t]=m.useState([]),[r,s]=m.useState(null),[n,o]=m.useState(!0),[l,c]=m.useState(null);m.useEffect(()=>{let i=!0;(async()=>{try{o(!0);const g=await $();i&&t(g)}catch{i&&c("Gagal memuat promosi.")}finally{i&&o(!1)}})();const d=async()=>{const{data:g,error:E}=await x.auth.getSession();E||!g.session?s(null):s(g.session.user)};d();const{data:u}=x.auth.onAuthStateChange(()=>{d()});return()=>{u.subscription.unsubscribe(),i=!1}},[]);const f=async(i,h)=>{try{if(!window.confirm("Apakah Anda yakin ingin menghapus promo ini?"))return;if(h){const u=h.split("/").pop(),{error:g}=await x.storage.from("promotion images").remove([u]);if(g)throw new Error(`Gagal menghapus gambar: ${g.message}`)}const{error:d}=await x.from("Promotion").delete().eq("id",i);if(d)throw new Error(`Gagal menghapus promo: ${d.message}`);t(u=>u.filter(g=>g.id!==i))}catch(d){alert(d.message||"Terjadi kesalahan saat menghapus promo.")}};return n?a.jsx("p",{children:"Loading..."}):l?a.jsx("p",{children:l}):a.jsx("div",{className:"overflow-hidden",children:a.jsx("div",{className:"flex relative w-full overflow-hidden my-12",children:a.jsx("div",{className:"w-full flex gap-20 md:gap-32 lg:gap-40 animate-loop-scroll",children:e.map(i=>a.jsxs("div",{className:"p-2 text-slate-950 flex flex-col items-stretch relative",children:[!i.imageUrl&&a.jsx("p",{className:"w-80 text-lg md:text-xl lg:text-2xl font-serif tracking-widest font-semibold text-primary",children:i.title}),i.imageUrl&&a.jsx("img",{loading:"lazy",className:"max-w-80 h-20 md:h-28 object-cover rounded-xl",src:i.imageUrl,alt:i.title}),r&&a.jsx("button",{onClick:()=>f(i.id,i.imageUrl),className:"w-auto py-0 px-2 text-black absolute -top-0 -right-2 backdrop-blur-md rounded shadow z-50",children:"X"})]},i.id))})})})},Te=()=>{const[e,t]=m.useState(null),[r,s]=m.useState(!1),{scrollYProgress:n}=Ne(),o=se(n,[0,1],[0,-500]);return m.useEffect(()=>{const l=async()=>{const{data:f,error:i}=await x.auth.getSession();i||!f.session?t(null):t(f.session.user)};l();const{data:c}=x.auth.onAuthStateChange(()=>{l()});return()=>{c.subscription.unsubscribe()}},[]),a.jsxs("section",{className:"overflow-hidden mt-52 md:mt-32 lg:mt-0",children:[a.jsxs("div",{className:"flex gap-4",children:[a.jsx(A.h1,{style:{x:o},className:"flex items-center text-[2em] font-mono font-semibold z-10 m-0 whitespace-nowrap mt-auto ml-8 transition-all duration-[2s] ease-[cubic-bezier(0.165,0.84,0.44,1)]",children:"Promo"}),e?a.jsx(A.button,{style:{x:o},onClick:()=>{s(!0)},className:"border border-dark px-4 rounded-lg z-10",children:"Tambahkan Promo"}):""]}),a.jsx(Ae,{}),r?a.jsx("div",{onClick:()=>{s(!1)},className:"w-full h-[100vh] bg-dark/50 flex justify-center items-center fixed left-0 top-0 z-[99]",children:a.jsx("div",{onClick:l=>l.stopPropagation(),children:a.jsx(ke,{})})}):""]})};export{Te as default};
